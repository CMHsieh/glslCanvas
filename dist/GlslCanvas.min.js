!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.GlslCanvas=t()}(this,function(){"use strict";function e(e,t,i){for(var r=0,n=e.length;r<n;r++)L.call(e,r)&&t.call(i,e[r],r,e)}function t(e,t,i){for(var r=0,n=e.length;r<n;r++)t.call(i,e.charAt(r),r,e)}function i(e,t,i){for(var r in e)L.call(e,r)&&t.call(i,e[r],r,e)}function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function n(e,t,i){var r=e;return _(t)?(i=t,"string"==typeof e&&(r={uri:e})):r=X(t,{uri:e}),r.callback=i,r}function o(e,t,i){return t=n(e,t,i),a(t)}function a(e){function t(){var e=void 0;if(e=u.response?u.response:u.responseText||s(u),y)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(c),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,l(e,E)}function n(){if(!f){var i;clearTimeout(c),i=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var r=E,n=null;return 0!==i?(r={body:t(),statusCode:i,method:g,headers:{},url:d,rawRequest:u},u.getAllResponseHeaders&&(r.headers=U(u.getAllResponseHeaders()))):n=new Error("Internal XMLHttpRequest Error"),l(n,r,r.body)}}if(void 0===e.callback)throw new Error("callback argument missing");var a=!1,l=function(t,i,r){a||(a=!0,e.callback(t,i,r))},u=e.xhr||null;u||(u=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var h,f,c,d=u.url=e.uri||e.url,g=u.method=e.method||"GET",v=e.body||e.data,m=u.headers=e.headers||{},p=!!e.sync,y=!1,E={body:void 0,headers:{},statusCode:0,method:g,url:d,rawRequest:u};if("json"in e&&!1!==e.json&&(y=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==g&&"HEAD"!==g&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),v=JSON.stringify(!0===e.json?v:e.json))),u.onreadystatechange=function(){4===u.readyState&&setTimeout(n,0)},u.onload=n,u.onerror=i,u.onprogress=function(){},u.onabort=function(){f=!0},u.ontimeout=i,u.open(g,d,!p,e.username,e.password),p||(u.withCredentials=!!e.withCredentials),!p&&e.timeout>0&&(c=setTimeout(function(){if(!f){f=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}},e.timeout)),u.setRequestHeader)for(h in m)m.hasOwnProperty(h)&&u.setRequestHeader(h,m[h]);else if(e.headers&&!r(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(v||null),u}function s(e){if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function l(e){return'\n<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>\n<td align="center">\n<div style="display: table-cell; vertical-align: middle;">\n<div style="">'+e+"</div>\n</div>\n</td></tr></table>\n"}function u(e,t){function i(t){var i=e.parentNode;i&&(i.innerHTML=l(t))}if(!window.WebGLRenderingContext)return i(N),null;var r=h(e,t);return r||i(j),r.getExtension("OES_standard_derivatives"),r}function h(e,t){for(var i=["webgl","experimental-webgl"],r=null,n=0;n<i.length;++n)try{r=e.getContext(i[n],t)}catch(e){if(r)break}return r}function f(e,t,i){var r=e.gl,n=r.createShader(i);return r.shaderSource(n,t),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(H=r.getShaderInfoLog(n),console.error("*** Error compiling shader "+n+":"+H),e.trigger("error",{shader:n,source:t,type:i,error:H}),r.deleteShader(n),null)}function c(e,t,i,r){for(var n=e.gl,o=n.createProgram(),a=0;a<t.length;++a)n.attachShader(o,t[a]);if(i)for(var s=0;s<i.length;++s)n.bindAttribLocation(o,r?r[s]:s,i[s]);return n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)?o:(H=n.getProgramInfoLog(o),console.log("Error in program linking:"+H),n.deleteProgram(o),null)}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[];for(var r in e){var n=e[r],o=void 0;if(t&&(r=t+"."+r),"number"==typeof n)i.push({type:"float",method:"1f",name:r,value:n});else if(Array.isArray(n)){if("number"==typeof n[0])1===n.length?i.push({type:"float",method:"1f",name:r,value:n}):n.length>=2&&n.length<=4?i.push({type:"vec"+n.length,method:n.length+"fv",name:r,value:n}):n.length>4&&i.push({type:"float[]",method:"1fv",name:r+"[0]",value:n});else if("string"==typeof n[0])i.push({type:"sampler2D",method:"1i",name:r,value:n});else if(Array.isArray(n[0])&&"number"==typeof n[0][0]){if(n[0].length>=2&&n[0].length<=4)for(o=0;o<n.length;o++)i.push({type:"vec"+n[0].length,method:n[o].length+"fv",name:r+"["+o+"]",value:n[o]})}else if("object"===I(n[0]))for(o=0;o<n.length;o++)i.push.apply(i,F(d(n[o],r+"["+o+"]")))}else"boolean"==typeof n?i.push({type:"bool",method:"1i",name:r,value:n}):"string"==typeof n?i.push({type:"sampler2D",method:"1i",name:r,value:n}):"object"===(void 0===n?"undefined":I(n))&&i.push.apply(i,F(d(n,r)))}return i}function g(e){return e.getBoundingClientRect().top+e.height>0&&e.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)}function v(e){return 0==(e&e-1)}function m(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function p(e,t){return!(!e||!t)&&e.toString()!==t.toString()}function y(e){var t=new Set;return Object.assign(e,{on:function(e,i){var r={};r[e]=i,t.add(r)},off:function(e,i){if(i){var r={};r[e]=i,t.delete(r)}else{var n=!0,o=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value,h=!0,f=!1,c=void 0;try{for(var d,g=Object.keys(u)[Symbol.iterator]();!(h=(d=g.next()).done);h=!0)if(d.value===e)return void t.delete(u)}catch(e){f=!0,c=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw c}}}}catch(e){o=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}}},listSubscriptions:function(){var e=!0,i=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;console.log(a)}}catch(e){i=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(i)throw r}}},subscribe:function(e){t.add(e)},unsubscribe:function(e){t.delete(e)},unsubscribeAll:function(){t.clear()},trigger:function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var o=!0,a=!1,s=void 0;try{for(var l,u=t[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;"function"==typeof h[e]&&h[e].apply(h,F(r))}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}}})}function E(){var e=document.getElementsByClassName("glslCanvas");if(e.length>0){window.glslCanvases=[];for(var t=0;t<e.length;t++){var i=new O(e[t]);i.isValid&&window.glslCanvases.push(i)}}}var T,b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},R=T="undefined"!=typeof window?window:void 0!==b?b:"undefined"!=typeof self?self:{},_=function(e){var t=x.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},x=Object.prototype.toString,w=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e,t){(t=e.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}),A=function(r,n,o){if(!_(n))throw new TypeError("iterator must be a function");arguments.length<3&&(o=this),"[object Array]"===S.call(r)?e(r,n,o):"string"==typeof r?t(r,n,o):i(r,n,o)},S=Object.prototype.toString,L=Object.prototype.hasOwnProperty,P=function(e){return"[object Array]"===Object.prototype.toString.call(e)},U=function(e){if(!e)return{};var t={};return A(w(e).split("\n"),function(e){var i=e.indexOf(":"),r=w(e.slice(0,i)).toLowerCase(),n=w(e.slice(i+1));void 0===t[r]?t[r]=n:P(t[r])?t[r].push(n):t[r]=[t[r],n]}),t},X=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)D.call(i,r)&&(e[r]=i[r])}return e},D=Object.prototype.hasOwnProperty,M=o;o.XMLHttpRequest=R.XMLHttpRequest||function(){},o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:R.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,i,r){return i=n(t,i,r),i.method=e.toUpperCase(),a(i)}});var I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k=(function(){function e(e){this.value=e}function t(t){function i(n,o){try{var a=t[n](o),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){i("next",e)},function(e){i("throw",e)}):r(a.done?"return":"normal",a.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?i(n.key,n.arg):o=null}var n,o;this._invoke=function(e,t){return new Promise(function(r,a){var s={key:e,arg:t,resolve:r,reject:a,next:null};o?o=o.next=s:(n=o=s,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),C=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),F=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},H="",N='\n\tThis page requires a browser that supports WebGL.<br/>\n\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>\n',j='\n\tIt does not appear your computer can support WebGL.<br/>\n\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>\n',G=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};k(this,e),y(this),this.gl=t,this.texture=t.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=i,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(r.filtering),this.load(r)}return C(e,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(t){this.valid&&("number"==typeof t&&e.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),e.activeUnit=t),e.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e.activeTexture=this.texture))}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=null,"string"==typeof e.url?void 0!==this.url&&e.url===this.url||this.setUrl(e.url,e):e.element?this.setElement(e.element,e):e.data&&e.width&&e.height&&this.setData(e.width,e.height,e.data,e)}},{key:"setUrl",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=e,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(r,n){var o=e.split(".").pop().toLowerCase(),a="ogv"===o||"webm"===o||"mp4"===o,s=void 0;a?((s=document.createElement("video")).autoplay=!0,i.filtering="nearest"):s=new Image,s.onload=function(){try{t.setElement(s,i)}catch(e){console.log("Texture '"+t.name+"': failed to load url: '"+t.source+"'",e,i)}r(t)},s.onerror=function(e){console.log("Texture '"+t.name+"': failed to load url: '"+t.source+"'",e,i),r(t)},m()&&"data:"===t.source.slice(0,5)||(s.crossOrigin="anonymous"),s.src=t.source,a&&t.setElement(s,i)}),this.loading}},{key:"setData",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=e,this.height=t,this.source=i,this.sourceType="data",this.update(r),this.setFiltering(r),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(e,t){var i=this,r=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.source=e,this.sourceType="element",e instanceof HTMLVideoElement?(e.addEventListener("canplaythrough",function(){i.intervalID=setInterval(function(){i.update(t)},15)},!0),e.addEventListener("ended",function(){e.currentTime=0,e.play()},!0)):this.update(t),this.setFiltering(t);else{var n="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";n+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+n,t)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==e.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),"element"===this.sourceType&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):"data"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){this.powerOf2=v(this.width)&&v(this.height);var t=this.powerOf2?"mipmap":"linear";this.filtering=e.filtering||t;var i=this.gl;this.bind(),this.powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e.TEXTURE_WRAP_S||e.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e.TEXTURE_WRAP_T||e.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),"mipmap"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):"linear"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):"nearest"===this.filtering&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST))):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),"mipmap"===this.filtering&&(this.filtering="linear"),"nearest"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)))}}}]),e}();G.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},G.activeUnit=-1;var O=function(){function e(t,i){function r(){g.nMouse>1&&g.setMouse(d),g.render(),g.forceRender=g.resize(),window.requestAnimationFrame(r)}var n=this;k(this,e),y(this),i=i||{},this.width=t.clientWidth,this.height=t.clientHeight,this.canvas=t,this.gl=void 0,this.program=void 0,this.textures={},this.uniforms={},this.vbo={},this.isValid=!1,this.vertexString=i.vertexString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",this.fragmentString=i.fragmentString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n    gl_FragColor = vec4(0.0);\n}\n";var o=u(t,i);if(o){if(this.gl=o,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,t.style.backgroundColor=i.backgroundColor||"rgba(1,1,1,0)",t.hasAttribute("data-fragment"))this.fragmentString=t.getAttribute("data-fragment");else if(t.hasAttribute("data-fragment-url")){var a=t.getAttribute("data-fragment-url");M.get(a,function(e,t,i){n.load(i,n.vertexString)})}if(t.hasAttribute("data-vertex"))this.vertexString=t.getAttribute("data-vertex");else if(t.hasAttribute("data-vertex-url")){var s=t.getAttribute("data-vertex-url");M.get(s,function(e,t,i){n.load(n.fragmentString,i)})}if(this.load(),this.program){var l=o.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=o.createBuffer(),this.gl.bindBuffer(o.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),o.STATIC_DRAW),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,o.FLOAT,!1,0,0);var h=o.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=o.createBuffer(),this.gl.bindBuffer(o.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),o.STATIC_DRAW),this.gl.enableVertexAttribArray(h),this.gl.vertexAttribPointer(h,2,o.FLOAT,!1,0,0),t.hasAttribute("data-textures")){var f=t.getAttribute("data-textures").split(",");for(var c in f)this.setUniform("u_tex"+c,f[c])}var d={x:0,y:0};document.addEventListener("mousemove",function(e){d.x=e.clientX||e.pageX,d.y=e.clientY||e.pageY},!1);var g=this;return this.setMouse({x:0,y:0}),r(),this}}}return C(e,[{key:"destroy",value:function(){this.animated=!1,this.isValid=!1;for(var e in this.textures)this.gl.deleteTexture(e);this.textures={};for(var t in this.attribs)this.gl.deleteBuffer(this.attribs[t]);this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.gl=null}},{key:"load",value:function(e,t){if(t&&(this.vertexString=t),e&&(this.fragmentString=e),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1,this.fragmentString.search(/sampler2D/g))for(var i=this.fragmentString.split("\n"),r=0;r<i.length;r++){var n=i[r].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(n){var o=n[2].split(".").pop().toLowerCase();n[1]&&n[2]&&("jpg"===o||"jpeg"===o||"png"===o||"ogv"===o||"webm"===o||"mp4"===o)&&this.setUniform(n[1],n[2])}if(i[r].match(/\s*void\s*main\s*/g))break}var a=f(this,this.vertexString,this.gl.VERTEX_SHADER),s=f(this,this.fragmentString,this.gl.FRAGMENT_SHADER);s?this.isValid=!0:(s=f(this,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",this.gl.FRAGMENT_SHADER),this.isValid=!1);var l=c(this,[a,s]);this.gl.useProgram(l),this.gl.deleteShader(a),this.gl.deleteShader(s),this.program=l,this.change=!0,this.trigger("load",{}),this.forceRender=!0}},{key:"test",value:function(e,t,i){function r(){f.paused=s,(t||i)&&f.load(a,o)}function n(){f.forceRender=!0,f.render();var o=l.getQueryObjectEXT(u,l.QUERY_RESULT_AVAILABLE_EXT),a=f.gl.getParameter(l.GPU_DISJOINT_EXT);if(o&&!a){var s={wasValid:h,frag:t||f.fragmentString,vert:i||f.vertexString,timeElapsedMs:l.getQueryObjectEXT(u,l.QUERY_RESULT_EXT)/1e6};r(),e(s)}else window.requestAnimationFrame(n)}var o=this.vertexString,a=this.fragmentString,s=this.paused,l=this.gl.getExtension("EXT_disjoint_timer_query"),u=l.createQueryEXT(),h=this.isValid;(t||i)&&(this.load(t,i),h=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,l.beginQueryEXT(l.TIME_ELAPSED_EXT,u),this.forceRender=!0,this.render(),l.endQueryEXT(l.TIME_ELAPSED_EXT);var f=this;n()}},{key:"loadTexture",value:function(e,t,i){var r=this;i||(i={}),"string"==typeof t?i.url=t:"object"===(void 0===t?"undefined":I(t))&&t.data&&t.width&&t.height?(i.data=t.data,i.width=t.width,i.height=t.height):"object"===(void 0===t?"undefined":I(t))&&(i.element=t),this.textures[e]?this.textures[e]&&(this.textures[e].load(i),this.textures[e].on("loaded",function(e){r.forceRender=!0})):(this.textures[e]=new G(this.gl,e,i),this.textures[e].on("loaded",function(e){r.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(e){for(var t={},i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t[e]=r,this.setUniforms(t)}},{key:"setUniforms",value:function(e){var t=d(e);for(var i in t)"sampler2D"===t[i].type?this.loadTexture(t[i].name,t[i].value[0]):(this.uniform(t[i].method,t[i].type,t[i].name,t[i].value),this.forceRender=!0)}},{key:"setMouse",value:function(e){var t=this.canvas.getBoundingClientRect();e&&e.x&&e.x>=t.left&&e.x<=t.right&&e.y&&e.y>=t.top&&e.y<=t.bottom&&this.uniform("2f","vec2","u_mouse",e.x-t.left,this.canvas.height-(e.y-t.top))}},{key:"uniform",value:function(e,t,i){this.uniforms[i]=this.uniforms[i]||{};for(var r=this.uniforms[i],n=arguments.length,o=Array(n>3?n-3:0),a=3;a<n;a++)o[a-3]=arguments[a];(p(r.value,o)||this.change||void 0===r.location||void 0===r.value)&&(r.name=i,r.value=o,r.type=t,r.method="uniform"+e,r.location=this.gl.getUniformLocation(this.program,i),this.gl[r.method].apply(this.gl,[r.location].concat(r.value)))}},{key:"uniformTexture",value:function(e,t,i){void 0===this.textures[e]?this.loadTexture(e,t,i):(this.uniform("1i","sampler2D",e,this.texureIndex),this.textures[e].bind(this.texureIndex),this.uniform("2f","vec2",e+"Resolution",this.textures[e].width,this.textures[e].height),this.texureIndex++)}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){var e=window.devicePixelRatio||1,t=Math.floor(this.gl.canvas.clientWidth*e),i=Math.floor(this.gl.canvas.clientHeight*e);return this.gl.canvas.width===t&&this.gl.canvas.height===i||(this.gl.canvas.width=t,this.gl.canvas.height=i,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,!0}return!1}},{key:"render",value:function(){if(this.visible=g(this.canvas),this.forceRender||this.animated&&this.visible&&!this.paused){var e=new Date,t=performance.now();this.timeDelta=(t-this.timePrev)/1e3,this.timePrev=t,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(t-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",e.getFullYear(),e.getMonth(),e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height),this.texureIndex=0;for(var i in this.textures)this.uniformTexture(i);this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"version",value:function(){return"0.0.25"}}]),e}();return window.GlslCanvas=O,window.addEventListener("load",function(){E()}),O});
//# sourceMappingURL=GlslCanvas.min.js.map
